<html>
    <head>
        <title>Markov Chains</title>
    </head>
<body>
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

<style>
    html,
    body,
    #container {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #story {
      width: 30%;
      height: 100%;
      float: left;
      overflow: auto;
    }
    #graph {
      width: 70%;
      height: 100%;
      float: left;
    }
    #story-text {
        padding-left: 10px;
        white-space: pre-wrap;
    }
    .highlighted {
        background-color: yellow;
    }
  </style>
  
  <div id="container">
    <p>Text: 
        <select id="text-choice" onchange="javascript:update()">
            <option selected>Green Eggs and Ham</option>
            <option>Out of the Woods</option>
            <option>HIP (MAMAMOO)</option>
        </select> 
       Words <input id="max-words" type="number" value="3" onchange="javascript:update()"/>
       <input type="checkbox" id="sentences" onchange="javascript:update()"> Sentences
    </p>
    <div id="story">
        <p id="story-text"></p>
    </div>
    <div id="graph"></div>
  </div>
<script type="text/javascript">
const books = 

{ 'Green Eggs and Ham': `I am Sam
Sam I am

That Sam-I-am
That Sam-I-am!
I do not like
that Sam-I-am

Do you like
green eggs and ham

I do not like them,
Sam-I-am.
I do not like
green eggs and ham.

Would you like them
Here or there?

I would not like them
here or there.
I would not like them
anywhere.
I do not like
green eggs and ham.
I do not like them,
Sam-I-am

Would you like them
in a house?
Would you like them
with a mouse?


I do not like them
in a house.
I do not like them
with a mouse.
I do not like them
here or there.
I do not like them
anywhere.
I do not like green eggs and ham.
I do not like them, Sam-I-am.

Would you eat them
in a box?
Would you eat them
with a fox?

Not in a box.
Not with a fox.
Not in a house.
Not with a mouse.
I would not eat them here or there.
I would not eat them anywhere.
I would not eat green eggs and ham.
I do not like them, Sam-I-am.


Would you? Could you?
in a car?
Eat them! Eat them!
Here they are.

I would not ,
could not,
in a car

You may like them.
You will see.
You may like them
in a tree?
d not in a tree.
I would not, could not in a tree.
Not in a car! You let me be.

I do not like them in a box.
I do not like them with a fox
I do not like them in a house
I do mot like them with a mouse
I do not like them here or there.
I do not like them anywhere.
I do not like green eggs and ham.
I do not like them, Sam-I-am.


A train! A train!
A train! A train!
Could you, would you
on a train?

Not on a train! Not in a tree!
Not in a car! Sam! Let me be!
I would not, could not, in a box.
I could not, would not, with a fox.
I will not eat them with a mouse
I will not eat them in a house.
I will not eat them here or there.
I will not eat them anywhere.
I do not like them, Sam-I-am.

Say!
In the dark?
Here in the dark!
Would you, could you, in the dark?

I would not, could not,
in the dark.

Would you, could you,
in the rain?

I would not, could not, in the rain.
Not in the dark. Not on a train,
Not in a car, Not in a tree.
I do not like them, Sam, you see.
Not in a house. Not in a box.
Not with a mouse. Not with a fox.
I will not eat them here or there.
I do not like them anywhere!

You do not like
green eggs and ham?

I do not
like them,
Sam-I-am.

Could you, would you,
with a goat?

I would not,
could not.
with a goat!

Would you, could you,
on a boat?

I could not, would not, on a boat.
I will not, will not, with a goat.
I will not eat them in the rain.
I will not eat them on a train.
Not in the dark! Not in a tree!
Not in a car! You let me be!
I do not like them in a box.
I do not like them with a fox.
I will not eat them in a house.
I do not like them with a mouse.
I do not like them here or there.
I do not like them ANYWHERE!

I do not like
green eggs
and ham!

I do not like them,
Sam-I-am.

You do not like them.
SO you say.
Try them! Try them!
And you may.
Try them and you may I say.

Sam!
If you will let me be,
I will try them.
You will see.


Say!
I like green eggs and ham!
I do!! I like them, Sam-I-am!
And I would eat them in a boat!
And I would eat them with a goat...
And I will eat them in the rain.
And in the dark. And on a train.
And in a car. And in a tree.
They are so good so good you see!

So I will eat them in a box.
And I will eat them with a fox.
And I will eat them in a house.
And I will eat them with a mouse.
And I will eat them here and there.
Say! I will eat them ANYWHERE!

I do so like
green eggs and ham!
Thank you!
Thank you,
Sam-I-am
`, 
'Out of the Woods': `Looking at it now
It all seems so simple
We were lying on your couch
I remember
You took a Polaroid of us
Then discovered (then discovered)
The rest of the world was black and white
But we were in screaming color
And I remember thinking

Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good
Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good

Are we out of the woods?

Looking at it now
Last December (last December)
We were built to fall apart
Then fall back together (back together)
Ooh, your necklace hanging from my neck, the night we couldn't quite forget
When we decided, we decided
To move the furniture so we could dance, baby, like we stood a chance
Two paper airplanes flying, flying, flying
And I remember thinking

Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good
Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good

Are we out of the woods?

Remember when you hit the brakes too soon
Twenty stitches in a hospital room
When you started crying, baby, I did too
But when the sun came up, I was looking at you
Remember when we couldn't take the heat
I walked out, I said, I'm setting you free
But the monsters turned out to be just trees
When the sun came up, you were looking at me

You were looking at me, oh
You were looking at me

(Are we out of the woods yet? Are we out of the woods yet?)
(Are we out of the woods yet? Are we out of the woods?) I remember
(Are we in the clear yet? Are we in the clear yet?)
(Are we in the clear yet? In the clear yet? Good) oh, I remember

Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good
Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good

Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good
Are we out of the woods yet? Are we out of the woods yet?
Are we out of the woods yet? Are we out of the woods?
Are we in the clear yet? Are we in the clear yet?
Are we in the clear yet? In the clear yet? Good
`,
'HIP (MAMAMOO)': `All I wanna be is 멋짐 내 마음대로 골라 kick it
머리 어깨 무릎 다 hip해
Do it, do it like me, do it, 나를 따라 해 kick it
Clapping, clapping 모두 같이 hip, hip, hip, hip
(Hip)
(Hip, hip, hip)
I love you 네가 뭐라든 간에
Respect you 네가 뭘 하든 간에 (She's crazy)
늘 따끈따끈해 그 관심이 따끔따끔해
또 힐끔 힐끔 힐끔 (Hip, hip, hip)
이젠 모든 일이 가뿐해 veteran
성공을 썰어 먹어 마치 michelin
누구보다 빠른 걸음을 걸었네 비시즌
잊은 지도 오래야 뒷걸음
All I wanna be is 멋짐 내 멋대로 골라 kick it
머리 어깨 무릎 다 hip (Hip, hip, hip)
삐삐삐 논란이 돼 my fashion (Oh)
별로 신경 안 써 그저 action (Yeah)
자꾸 click me, click me 홀린 듯이 zoom
Close up, close up, close up
Hip 해 hip, hip 머리 어깨 무릎 hip
Hip, hip, hi-hi-hi-hip 해
Hip, hip 머리 어깨 무릎 hip
(Hip, hip) Hi-hi-hi-hip 해 hip (Hip, hip, hip)
(Attention) 어딜 가든 넌
(Reflection) 빛날 수 있어 (Yeah)
세상에 넌 하나뿐인 걸
근데 왜이래 네 얼굴에 침 뱉니 (칵투)
날 자극한 여러분 감사
거기서 멈춘 찌질이 반사
덕분에 나의 멘탈은 단단해
난 다음 앨범 만들러 갈게
All you wanna be is trendy 어그로 끌기 gimmick 때찌
그런 애들 끼리끼리 hip (Hip, hip, hip)
삐삐삐 논란이 돼 my fashion (Oh)
별로 신경 안 써 그저 action (Yeah)
자꾸 click me, click me 홀린 듯이 zoom
Close up, close up, close up
Hip 해 hip, hip 머리 어깨 무릎 hip
Hip, hip, hi-hi-hi-hip 해
Hip, hip 머리 어깨 무릎 hip
(Hip, hip) Hi-hi-hi-hip 해 hip (Hip, hip, hip)
코 묻은 티 삐져나온 입
떡진 머리 난 상관없지
코 묻은 티 삐져나온 입
떡진 머리 내가 하면 hip
코 묻은 티 삐져나온 팬티
떡진 머리 난 상관없지
코 묻은 티 삐져나온 팬티
떡진 머리 내가 하면 hip
삐삐삐 논란이 돼 my fashion (Oh)
별로 신경 안 써 그저 action (Yeah)
자꾸 click me, click me 홀린 듯이 zoom
Close up, close up, close up
Hip 해 hip, hip 머리 어깨 무릎 hip
Hip, hip, hi-hi-hi-hip 해
Hip, hip 머리 어깨 무릎 hip
(Hip, hip) Hi-hi-hi-hip 해 hip (Hip, hip, hip)`};

// Split the book into words
const segmenter = new Intl.Segmenter([], { granularity: 'word' });

    function updateStory() {
        const selectedText = document.getElementById("text-choice").value;
        const book = books[selectedText];
        // Make a paragraph for every sentence in the story
        var storyHTML = "";
        var sentences = book.split("\n").filter(s => s.length > 0);
        var maxWords = document.getElementById("max-words").value;
        var sentenceIndex = 0;
        var i = 0;
        sentences.forEach(function (sentence) {
            var sentenceHTML = "";

            const segmentedSentence = segmenter.segment(sentence);
            const words = [...segmentedSentence].filter(s => s.isWordLike).map(s => s.segment);

            // Make a span tag for every word in the story
            words.forEach(function (word) {
                if (i < maxWords) {
                    sentenceHTML += "<span class='highlighted'>" + word + "</span> ";
                } else {
                    sentenceHTML += "<span>" + word + "</span> ";
                }
                i ++;
            });

            if (document.getElementById("sentences").checked && sentenceIndex < maxWords) {
                storyHTML += "<p class='highlighted'>" + sentenceHTML + "</p>";
            } else {
                storyHTML += "<p>" + sentenceHTML + "</p>";
            }
            sentenceIndex ++;
        });

        // Replace the innerHTML of the story element with the spans
        document.getElementById("story-text").innerHTML = storyHTML;
    }    


    function updateGraph() {
        const selectedText = document.getElementById("text-choice").value;
        const book = books[selectedText];

        const segmentedText = segmenter.segment(book);
        var words = [...segmentedText].filter(s => s.isWordLike).map(s => s.segment);
        if (document.getElementById("sentences").checked) {
            // Use sentences instead of words
            words = book.split("\n").filter(s => s.length > 0);
        }

        // Get the number of words to display
        var maxWords = document.getElementById("max-words").value;

        // Keep a list of unique words
        var uniqueWords = new Set();

        // Go through each word, up to LIMIT
        var wordNodes = [];
        var storyEdges = [];

        // Make sure maxWords is within the range of the number of words in the book
        if (maxWords > words.length) {
            maxWords = words.length;
        }

        for (var i = 0; i < maxWords; i++) {
        // Have we seen this word before? If no, add a node
        if (!uniqueWords.has(words[i])) {
            uniqueWords.add(words[i]);
            wordNodes.push({
                id: words[i],
                label: words[i],
                value: 1,
            });
        } else {
            // Make the node bigger!
            wordNodes.forEach(function (node) {
                if (node.id === words[i]) {
                    node.value += 1;
                }
            });
        }

        // If we're beyond the first word, connect this word with the previous one
        if (i > 0) {
            // Does the edge already exist?
            var edgeExists = false;
            storyEdges.forEach(function (edge) {
                if (edge.from === words[i - 1] && edge.to === words[i]) {
                    edge.label = (parseInt(edge.label) + 1).toString();
                    edge.value ++;
                    edgeExists = true;
                }
            });
            
            if (!edgeExists) {
                storyEdges.push({
                    from: words[i - 1], 
                    to: words[i],
                    label: "1",
                    value: 1,
                    arrows: {
                        to: {
                            enabled: true,
                            type: "arrow",
                        },
                    },
                });
            }
        }
        }

        // create an array with nodes
        var nodes = new vis.DataSet(wordNodes);

        // create an array with edges
        var edges = new vis.DataSet(storyEdges);

        // create a network
        var container = document.getElementById("graph");
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {
          nodes: {
            shape: "dot",
            scaling: {
              min: 5,
              max: 10,
              label: {
                min: 10,
                max: 15,
              },
            },
          },
          layout: { randomSeed: 2 },
          interaction: { hover: true },
        };
        var network = new vis.Network(container, data, options);
        network.fit({ animation: { duration: 1000 } });
        network.on("click", function (params) {
            params.event = "[original event]";
            var node = this.getNodeAt(params.pointer.DOM);
            if (!node) {
                return;
            }
            var edges = this.getConnectedEdges(node);
            // Get all edges that start from this node
            edges.forEach(function (edge) {
                if (edge.from === node) {
                    node.color = "red";
                }
            });
        });
        network.on("showPopup", function (nodeId) {
            console.log(network.getNodeAt(nodeId));
        });
}

function update() {
    updateStory();
    updateGraph();
}
update();

</script>
