<html>
<body>
<script type="text/javascript" src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
<!--
  Including other packages like Vis Timeline or Vis Graph3D here won't work.
  You need the peer build to do that.
-->
<style>
    html,
    body,
    #container {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      overflow: hidden;
    }
    #story {
      width: 30%;
      height: 100%;
      float: left;
      overflow: auto;
    }
    #graph {
      width: 70%;
      height: 100%;
      float: left;
    }
    #story-text {
        padding-left: 10px;
        white-space: pre-wrap;
    }
    .highlighted {
        background-color: yellow;
    }
  </style>
  
  <div id="container">
    <p>Words <input id="maxWords" type="number" value="3" onchange="javascript:update()"/></p>
    <div id="story">
        <h1>Green Eggs and Ham</h1>
        <p id="story-text"></p>
    </div>
    <div id="graph"></div>
  </div>
<script type="text/javascript">
const book = `
I am Sam
Sam I am

That Sam-I-am
That Sam-I-am!
I do not like
that Sam-I-am

Do you like
green eggs and ham

I do not like them,
Sam-I-am.
I do not like
green eggs and ham.

Would you like them
Here or there?

I would not like them
here or there.
I would not like them
anywhere.
I do not like
green eggs and ham.
I do not like them,
Sam-I-am

Would you like them
in a house?
Would you like them
with a mouse?


I do not like them
in a house.
I do not like them
with a mouse.
I do not like them
here or there.
I do not like them
anywhere.
I do not like green eggs and ham.
I do not like them, Sam-I-am.

Would you eat them
in a box?
Would you eat them
with a fox?

Not in a box.
Not with a fox.
Not in a house.
Not with a mouse.
I would not eat them here or there.
I would not eat them anywhere.
I would not eat green eggs and ham.
I do not like them, Sam-I-am.


Would you? Could you?
in a car?
Eat them! Eat them!
Here they are.

I would not ,
could not,
in a car

You may like them.
You will see.
You may like them
in a tree?
d not in a tree.
I would not, could not in a tree.
Not in a car! You let me be.

I do not like them in a box.
I do not like them with a fox
I do not like them in a house
I do mot like them with a mouse
I do not like them here or there.
I do not like them anywhere.
I do not like green eggs and ham.
I do not like them, Sam-I-am.


A train! A train!
A train! A train!
Could you, would you
on a train?

Not on a train! Not in a tree!
Not in a car! Sam! Let me be!
I would not, could not, in a box.
I could not, would not, with a fox.
I will not eat them with a mouse
I will not eat them in a house.
I will not eat them here or there.
I will not eat them anywhere.
I do not like them, Sam-I-am.

Say!
In the dark?
Here in the dark!
Would you, could you, in the dark?

I would not, could not,
in the dark.

Would you, could you,
in the rain?

I would not, could not, in the rain.
Not in the dark. Not on a train,
Not in a car, Not in a tree.
I do not like them, Sam, you see.
Not in a house. Not in a box.
Not with a mouse. Not with a fox.
I will not eat them here or there.
I do not like them anywhere!

You do not like
green eggs and ham?

I do not
like them,
Sam-I-am.

Could you, would you,
with a goat?

I would not,
could not.
with a goat!

Would you, could you,
on a boat?

I could not, would not, on a boat.
I will not, will not, with a goat.
I will not eat them in the rain.
I will not eat them on a train.
Not in the dark! Not in a tree!
Not in a car! You let me be!
I do not like them in a box.
I do not like them with a fox.
I will not eat them in a house.
I do not like them with a mouse.
I do not like them here or there.
I do not like them ANYWHERE!

I do not like
green eggs
and ham!

I do not like them,
Sam-I-am.

You do not like them.
SO you say.
Try them! Try them!
And you may.
Try them and you may I say.

Sam!
If you will let me be,
I will try them.
You will see.


Say!
I like green eggs and ham!
I do!! I like them, Sam-I-am!
And I would eat them in a boat!
And I would eat them with a goat...
And I will eat them in the rain.
And in the dark. And on a train.
And in a car. And in a tree.
They are so good so good you see!

So I will eat them in a box.
And I will eat them with a fox.
And I will eat them in a house.
And I will eat them with a mouse.
And I will eat them here and there.
Say! I will eat them ANYWHERE!

I do so like
green eggs and ham!
Thank you!
Thank you,
Sam-I-am
`;
// Split the book into words
const segmenter = new Intl.Segmenter([], { granularity: 'word' });
const segmentedText = segmenter.segment(book);
const words = [...segmentedText].filter(s => s.isWordLike).map(s => s.segment);

    function updateStory() {
        // Make a paragraph for every sentence in the story
        var storyHTML = "";
        var sentences = book.split("\n");
        var maxWords = document.getElementById("maxWords").value;
        var i = 0;
        sentences.forEach(function (sentence) {
            var sentenceHTML = "";

            const segmentedSentence = segmenter.segment(sentence);
            const words = [...segmentedSentence].filter(s => s.isWordLike).map(s => s.segment);

            // Make a span tag for every word in the story
            words.forEach(function (word) {
                if (i < maxWords) {
                    sentenceHTML += "<span class='highlighted'>" + word + "</span> ";
                } else {
                    sentenceHTML += "<span>" + word + "</span> ";
                }
                i ++;
            });

            storyHTML += "<p>" + sentenceHTML + "</p>";
        });

        // Replace the innerHTML of the story element with the spans
        document.getElementById("story-text").innerHTML = storyHTML;
    }    


    function updateGraph() {
        // Get the number of words to display
        var maxWords = document.getElementById("maxWords").value;

        // Keep a list of unique words
        var uniqueWords = new Set();

        // Go through each word, up to LIMIT
        var wordNodes = [];
        var storyEdges = [];

        // Make sure maxWords is within the range of the number of words in the book
        maxWords = Math.min(maxWords, words.length);

        for (var i = 0; i < maxWords; i++) {
        // Have we seen this word before? If no, add a node
        if (!uniqueWords.has(words[i])) {
            uniqueWords.add(words[i]);
            wordNodes.push({
                id: words[i],
                label: words[i],
                value: 1,
            });
        } else {
            // Make the node bigger!
            wordNodes.forEach(function (node) {
                if (node.id === words[i]) {
                    node.value += 1;
                }
            });
        }

        // If we're beyond the first word, connect this word with the previous one
        if (i > 0) {
            // Does the edge already exist?
            var edgeExists = false;
            storyEdges.forEach(function (edge) {
                if (edge.from === words[i - 1] && edge.to === words[i]) {
                    edge.label = (parseInt(edge.label) + 1).toString();
                    edgeExists = true;
                }
            });
            
            if (!edgeExists) {
                storyEdges.push({
                    from: words[i - 1], 
                    to: words[i],
                    label: "1",
                    arrows: {
                        to: {
                            enabled: true,
                            type: "arrow",
                        },
                    },
                });
            }
        }
        }

        // create an array with nodes
        var nodes = new vis.DataSet(wordNodes);

        // create an array with edges
        var edges = new vis.DataSet(storyEdges);

        // create a network
        var container = document.getElementById("graph");
        var data = {
            nodes: nodes,
            edges: edges
        };
        var options = {};
        var network = new vis.Network(container, data, options);
}

function update() {
    updateStory();
    updateGraph();
}
update();

</script>
